# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0

name                depot-tools-devel

version             20200530
categories          devel
platforms           darwin
license             Permissive

description         Tools for working with Chromium development.
long_description    {*}${description}

homepage            https://chromium.googlesource.com/chromium/tools/depot_tools

maintainers         {gmail.com:herby.gillot @herbygillot} \
                    openmaintainer

fetch.type          git
git.url             ${homepage}.git
git.branch          99044852de36333f88644adfd074189c05eaec12

depends_lib         port:ninja \
                    port:python38

installs_libs       no
use_configure       no

set dtpath          ${prefix}/libexec/depot-tools

build               {}

destroot {
    xinstall -m 755 -d ${destroot}${dtpath}
    copy {*}[glob ${worksrcpath}/*] ${destroot}${dtpath}/

    # Replace the pre-bundled ninja-mac binary with the ninja from ports.
    file delete ${destroot}${dtpath}/ninja-mac
    file link ${destroot}${dtpath}/ninja-mac ${prefix}/bin/ninja
}

notes "
    To use depot-tools, edit your shell's rc file (~/.bashrc, ~/.zshrc, ...),
    and add the following:

    export DEPOT_TOOLS_UPDATE=0
    export PATH=\"${dtpath}:\$PATH\"
"
