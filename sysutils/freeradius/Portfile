# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               github      1.0
PortGroup               muniversal  1.0
PortGroup               openssl     1.0
PortGroup               perl5       1.0

github.setup            FreeRADIUS freeradius-server 3_0_25 release_
version                 [string map {_ .} ${github.version}]
github.tarball_from     releases
name                    freeradius
revision                0
checksums               rmd160  52ef71e091e5149a3311846b0ec7861ffefcc6d4 \
                        sha256  fc158cdab4a705b179b1a91cd72473006ef4dfb570b0d097db6c9c34049a4509 \
                        size    3402380

categories              sysutils
maintainers             nomaintainer
homepage                https://freeradius.org
platforms               darwin freebsd
license                 LGPL-2.1+
distname                ${name}-server-${version}

description             Free Radius Implementation

long_description        The FreeRADIUS Server Project is an attempt to create \
                        a high-performance and highly-configurable GPLd free \
                        RADIUS server. The server is similar to Livingston's \
                        2.0 server. FreeRADIUS is a variant of the Cistron \
                        RADIUS server, but they don't share a lot in common \
                        anymore.

openssl.branch          1.1

depends_lib-append      port:libtool \
                        port:libpcap \
                        path:lib/libldap.dylib:openldap \
                        port:talloc \
                        port:gdbm   \
                        port:pcre   \
                        port:perl${perl5.default_branch}

configure.args          --with-openssl-includes=[openssl::include_dir] \
                        --with-openssl-libraries=[openssl::lib_dir] \
                        --with-system-libltdl \
                        --with-system-libtool \
                        --without-rlm_krb5

use_autoconf            yes
use_bzip2               yes
use_parallel_build      no

# Disable silent rules.
build.args-append       VERBOSE=1

destroot.env-append     R=${destroot}

variant kerberos description { Use Kerberos } {
    depends_lib-append port:kerberos5
    configure.args-delete --without-rlm_krb5
}

variant mysql5 conflicts mysql51 mysql55 mysql56 mariadb percona description {Build with MySQL support using mysql5} {
    depends_lib-append port:mysql5
    configure.args-append \
                        --with-modules=rlm_sql \
                        --with-mysql-lib-dir=${prefix}/lib/mysql5/mysql \
                        --with-mysql-include-dir=${prefix}/include/mysql5
}

variant mysql51 conflicts mysql5 mysql55 mysql56 mariadb percona description {Build with MySQL support using mysql51} {
    depends_lib-append port:mysql51
    configure.args-append \
                        --with-modules=rlm_sql \
                        --with-mysql-lib-dir=${prefix}/lib/mysql51/mysql \
                        --with-mysql-include-dir=${prefix}/include/mysql51
}

variant mysql55 conflicts mysql5 mysql51 mysql56 mariadb percona description {Build with MySQL support using mysql55} {
    depends_lib-append port:mysql55
    configure.args-append \
                        --with-modules=rlm_sql \
                        --with-mysql-lib-dir=${prefix}/lib/mysql55/mysql \
                        --with-mysql-include-dir=${prefix}/include/mysql55
}

variant mysql56 conflicts mysql5 mysql51 mysql55 mariadb percona description {Build with MySQL support using mysql56} {
    depends_lib-append port:mysql56
    configure.args-append \
                        --with-modules=rlm_sql \
                        --with-mysql-lib-dir=${prefix}/lib/mysql56/mysql \
                        --with-mysql-include-dir=${prefix}/include/mysql56
}

variant mariadb conflicts mysql5 mysql51 mysql55 mysql56 percona description {Build with MySQL support using mariadb} {
    depends_lib-append port:mariadb
    configure.args-append \
                        --with-modules=rlm_sql \
                        --with-mysql-lib-dir=${prefix}/lib/mysql5/mysql \
                        --with-mysql-include-dir=${prefix}/include/mysql5
}

variant percona conflicts mysql5 mysql51 mysql55 mysql56 mariadb description {Build with MySQL support using percona} {
    depends_lib-append port:percona
    configure.args-append \
                        --with-modules=rlm_sql \
                        --with-mysql-lib-dir=${prefix}/lib/percona/mysql \
                        --with-mysql-include-dir=${prefix}/include/percona
}

github.livecheck.regex {([0-9_]+)}
